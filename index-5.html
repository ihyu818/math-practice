<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>MATH LAB - HUB</title>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@1,700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script src="game-config.js"></script>

  <style>
    body { background-color: #ffffff; }
    .math-font { 
        font-family: 'Lora', serif; 
        font-style: italic; 
        font-variant-numeric: tabular-nums; 
        -webkit-font-smoothing: antialiased;
    }
    .icon-card {
      aspect-ratio: 1 / 1;
      width: 100%;
      display: flex; align-items: center; justify-content: center;
      border-radius: 1.75rem; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer; user-select: none; -webkit-tap-highlight-color: transparent;
      border: 1px solid rgba(0,0,0,0.05);
    }
    .icon-card:active { transform: scale(0.92); }
    
    /* 符號字級改由 JS 動態控制或保留基礎類別 */
    .icon-symbol { font-size: clamp(3.5rem, 14vw, 5rem); line-height: 1; }
    .icon-symbol-small { 
      font-size: clamp(2rem, 9.5vw, 3.2rem); 
      line-height: 1; 
      letter-spacing: -0.05em;
    }

    .exponent-base { position: relative; display: inline-block; }
    .exponent-power { 
      font-size: 0.55em; 
      position: absolute; 
      top: -0.15em; 
      left: 0.8em; 
    }

    .grid-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 1.5rem;
      width: 100%;
      max-width: 520px;
      justify-content: center;
    }

    @media (max-width: 400px) {
      .grid-container {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
      }
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-6 text-slate-800">

  <header class="text-center mb-10">
    <h1 class="text-4xl font-black italic text-slate-900 tracking-tighter leading-none">
      <span class="uppercase">Math Lab</span><br>
      <span class="text-pink-600 text-2xl tracking-[0.2em] ml-1 uppercase">QUEST</span>
    </h1>
  </header>
  
  <div class="mb-10 w-full max-w-[320px]">
    <input type="text" id="globalName" maxlength="16" 
           class="w-full px-4 py-3 border-2 border-slate-200 rounded-2xl text-center font-bold text-lg outline-none focus:border-pink-500 transition-all shadow-sm" 
           placeholder="輸入您的姓名">
    <p id="errorMsg" class="text-red-500 text-xs mt-2 text-center font-bold hidden">使用者名稱不能超過 16 個字元</p>
  </div>

  <main id="game-grid" class="grid-container"></main>

  <script>
    // 1. 版本檢查邏輯保持不變
    async function forceUpdateIfNeeded() {
        try {
            const response = await fetch(`config.json?t=${Date.now()}`);
            const remote = await response.json();
            const localVersion = localStorage.getItem('math_lab_version');
            if (localVersion && localVersion !== remote.version) {
                localStorage.setItem('math_lab_version', remote.version);
                window.location.reload(true);
            } else {
                localStorage.setItem('math_lab_version', remote.version);
            }
        } catch (e) { console.error("版本檢查失敗", e); }
    }
    forceUpdateIfNeeded();
    
    // 2. 初始化與渲染
    window.onload = () => {
      const savedName = localStorage.getItem('math_lab_name');
      if (savedName) document.getElementById('globalName').value = savedName;
      renderMenu();
    };

    // 核心修改：從 GAME_CONFIG 畫出按鈕
    function renderMenu() {
        const grid = document.getElementById('game-grid');
        grid.innerHTML = ''; // 清空原有 HTML

        Object.values(GAME_CONFIG).forEach(game => {
            const card = document.createElement('div');
            // 設定樣式與顏色
            card.className = `icon-card ${game.isSmall ? 'icon-symbol-small' : 'icon-symbol'}`;
            card.style.backgroundColor = game.bgColor;
            card.style.color = game.textColor;
            card.style.boxShadow = `8px 12px 20px -5px ${game.shadow}`;
            
            // 放入符號內容
            card.innerHTML = game.symbol;
            
            // 綁定點擊事件
            card.onclick = () => goToGame(game.url);
            
            grid.appendChild(card);
        });
    }

    function goToGame(url) {
      const nameInput = document.getElementById('globalName');
      const errorMsg = document.getElementById('errorMsg');
      const name = nameInput.value.trim();
      
      if (name !== "" && name.length <= 16) {
        errorMsg.classList.add('hidden');
        localStorage.setItem('math_lab_name', name); 
        const version = new Date().getTime(); 
        window.location.href = `${url}?v=${version}`; 
      } else {
        errorMsg.classList.remove('hidden');
        nameInput.classList.add('border-red-500');
        setTimeout(() => nameInput.classList.remove('border-red-500'), 2000);
      }
    }
  </script>
</body>
</html>
